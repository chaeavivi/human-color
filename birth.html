<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>휴먼컬러 결과지 생성 프로그램</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --bg-color: #f5f5f5;
            --primary-color: #333;
            --border-color: #e0e0e0;
            --label-bg: #f2f2f2; /* 결과지 왼쪽 라벨 배경색 */
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* --- 입력 폼 스타일 --- */
        .control-panel {
            max-width: 800px;
            margin: 0 auto 30px auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .control-panel h1 { font-size: 24px; margin-bottom: 20px; text-align: center; }
        
        .input-group { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;}
        .input-box { flex: 1; min-width: 150px; }
        .input-box label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; color: #555; }
        .input-box input, .input-box select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        .btn-row { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-calc { background-color: #4a90e2; color: white; }
        .btn-calc:hover { background-color: #357abd; }
        .btn-down { background-color: #333; color: white; }
        .btn-down:hover { background-color: #555; }

        /* --- 결과지(A4) 스타일 --- */
        .report-container {
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            background: white;
            margin: 0 auto;
            padding: 40px 50px; /* 여백 조정 */
            box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        /* 헤더 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .user-title { font-size: 26px; font-weight: 700; }
        .report-meta { text-align: right; font-size: 14px; color: #666; }
        .report-meta h3 { margin: 0 0 5px 0; font-size: 18px; color: #333; }

        /* 속성 섹션 (W- 등) */
        .attr-section {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }
        .attr-code-box {
            width: 80px;
            height: 80px;
            background-color: var(--label-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            color: #333;
            margin-right: 20px;
            border-radius: 4px;
        }
        .attr-desc {
            flex: 1;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-line;
            display: flex;
            align-items: center;
        }

        /* 요약 그리드 (4칸) */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 40px;
        }
        .sum-card {
            background: #fafafa;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 4px;
        }
        .sum-title { font-size: 12px; color: #888; margin-bottom: 5px; font-weight: bold; }
        .sum-val { font-size: 15px; font-weight: bold; margin-bottom: 8px; color: #333; }
        .sum-desc { font-size: 11px; color: #666; line-height: 1.4; white-space: pre-line; }

        /* 메인 컬러 섹션 (4행) */
        .main-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .section-row {
            display: flex;
            border: 1px solid #e0e0e0;
            height: 180px; /* 고정 높이 유지 */
        }
        .section-label {
            width: 15%; /* 왼쪽 라벨 영역 */
            background-color: var(--label-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-right: 1px solid #e0e0e0;
        }
        .lbl-order { font-size: 12px; color: #666; margin-bottom: 5px; }
        .lbl-main { font-size: 18px; font-weight: 800; color: #333; }
        
        .section-content {
            width: 85%;
            padding: 20px;
            position: relative;
        }
        .color-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 8px;
        }
        .color-name {
            font-size: 20px;
            font-weight: 800;
            margin-right: 20px;
            /* color는 JS에서 주입 */
        }
        .color-keywords {
            font-size: 13px;
            color: #666;
            flex: 1;
        }
        .color-desc {
            font-size: 13px;
            line-height: 1.5;
            color: #444;
            white-space: pre-line;
        }

        /* PDF 생성 시 숨길 요소 */
        .hide-on-pdf { }

    </style>
</head>
<body>

    <div class="control-panel hide-on-pdf">
        <h1>휴먼컬러 분석기</h1>
        <div class="input-group">
            <div class="input-box">
                <label>이름</label>
                <input type="text" id="inpName" placeholder="예: 홍길동">
            </div>
            <div class="input-box">
                <label>생년월일</label>
                <input type="date" id="inpDate">
            </div>
            <div class="input-box">
                <label>태어난 시간</label>
                <input type="time" id="inpTime">
            </div>
            <div class="input-box">
                <label>속성 (선택)</label>
                <select id="inpAttr">
                    <option value="W-">W- (수음/조용한)</option>
                    <option value="W+">W+ (수양/자유로운)</option>
                    <option value="T+">T+ (목양/정직한)</option>
                    <option value="T-">T- (목음/유순한)</option>
                    <option value="F+">F+ (화양/낙천적인)</option>
                    <option value="F-">F- (화음/섬세한)</option>
                    <option value="E+">E+ (토양/느긋한)</option>
                    <option value="E-">E- (토음/서민적인)</option>
                    <option value="M+">M+ (금양/다부진)</option>
                    <option value="M-">M- (금음/아름다운)</option>
                </select>
            </div>
        </div>
        
        <div style="background:#f9f9f9; padding:10px; border-radius:5px; margin-bottom:15px;">
            <label style="font-size:12px; font-weight:bold; color:#888;">자동 계산된 숫자 (수동 수정 가능)</label>
            <div class="input-group" style="margin-bottom:0; margin-top:5px;">
                <div class="input-box"><input type="number" id="resNum1" placeholder="1. 선천"></div>
                <div class="input-box"><input type="number" id="resNum2" placeholder="2. 후천"></div>
                <div class="input-box"><input type="number" id="resNum3" placeholder="3. 목표"></div>
                <div class="input-box"><input type="number" id="resNum4" placeholder="4. 노하우"></div>
            </div>
        </div>

        <div class="btn-row">
            <button class="btn-calc" onclick="calculateAndRender()">자동 계산 & 미리보기</button>
            <button class="btn-down" onclick="downloadPDF()">PDF 다운로드</button>
        </div>
    </div>

    <div id="reportArea" class="report-container">
        
        <div class="header">
            <div class="user-info">
                <div class="user-title" id="outName">홍길동 1990.01.01</div>
            </div>
            <div class="report-meta">
                <h3>휴먼컬러 분석</h3>
                <div id="outDate">2023-12-05</div>
            </div>
        </div>

        <div class="attr-section">
            <div class="attr-code-box" id="outAttrCode">W-</div>
            <div class="attr-desc" id="outAttrDesc">
                속성 설명이 여기에 표시됩니다.
            </div>
        </div>

        <div class="summary-grid">
            <div class="sum-card">
                <div class="sum-title">1st 선천/사고</div>
                <div class="sum-val" id="sum1_val">-</div>
                <div class="sum-desc" id="sum1_desc"></div>
            </div>
            <div class="sum-card">
                <div class="sum-title">2nd 후천/행동</div>
                <div class="sum-val" id="sum2_val">-</div>
                <div class="sum-desc" id="sum2_desc"></div>
            </div>
            <div class="sum-card">
                <div class="sum-title">3rd 목표/바람</div>
                <div class="sum-val" id="sum3_val">-</div>
                <div class="sum-desc" id="sum3_desc"></div>
            </div>
            <div class="sum-card">
                <div class="sum-title">4th 노하우/방향</div>
                <div class="sum-val" id="sum4_val">-</div>
                <div class="sum-desc" id="sum4_desc"></div>
            </div>
        </div>

        <div class="main-section">
            
            <div class="section-row">
                <div class="section-label">
                    <span class="lbl-order">1st 선천</span>
                    <span class="lbl-main">사고</span>
                </div>
                <div class="section-content">
                    <div class="color-header">
                        <span class="color-name" id="main1_color">COLOR</span>
                        <span class="color-keywords" id="main1_key">키워드</span>
                    </div>
                    <div class="color-desc" id="main1_text">내용</div>
                </div>
            </div>

            <div class="section-row">
                <div class="section-label">
                    <span class="lbl-order">2nd 후천</span>
                    <span class="lbl-main">행동</span>
                </div>
                <div class="section-content">
                    <div class="color-header">
                        <span class="color-name" id="main2_color">COLOR</span>
                        <span class="color-keywords" id="main2_key">키워드</span>
                    </div>
                    <div class="color-desc" id="main2_text">내용</div>
                </div>
            </div>

            <div class="section-row">
                <div class="section-label">
                    <span class="lbl-order">3rd 목표</span>
                    <span class="lbl-main">바람</span>
                </div>
                <div class="section-content">
                    <div class="color-header">
                        <span class="color-name" id="main3_color">COLOR</span>
                        <span class="color-keywords" id="main3_key">키워드</span>
                    </div>
                    <div class="color-desc" id="main3_text">내용</div>
                </div>
            </div>

            <div class="section-row">
                <div class="section-label">
                    <span class="lbl-order">4th 노하우</span>
                    <span class="lbl-main">방향</span>
                </div>
                <div class="section-content">
                    <div class="color-header">
                        <span class="color-name" id="main4_color">COLOR</span>
                        <span class="color-keywords" id="main4_key">키워드</span>
                    </div>
                    <div class="color-desc" id="main4_text">내용</div>
                </div>
            </div>

        </div>

    </div>

    <script>
        /* * ==========================================
         * 데이터베이스 (1~12번 컬러 및 속성 데이터)
         * ==========================================
         */
        const humanColorData = {
            1: { color: "MAGENTA", keyword: "대지", title: "대지, 포용력, 수용, 유연, 여유, 매력", 
                 desc: "+ 큰 마음으로 다른 것들을 받아들일 수 있는 힘이 있습니다.\n+ 자신만의 영역을 키워가는 성향이며, 군더더기 없는 깔끔함을 선호합니다.\n+ 리더십이 있고, 안되는 것은 없습니다. 강한 정신력을 갖고 있습니다.\n+ 자신의 사람들을 소중하게 생각하여 적재적소에 인재를 쓸 수 있는 능력도 갖고 있습니다.\n+ 주의 : 근자감 주의, 외곬수, 고집쟁이, 질투",
                 desc_detail: "+넓은 마음으로 소중하게 여기는 다른 사람을 이해하고 수용합니다.\n+침착하고 사람을 안정적으로 이끄는 리더타입입니다.\n+독립적인 사고와 깊은 통찰력이 우수합니다." },
            2: { color: "RED", keyword: "태양", title: "행동력, 태양, 행동, 열정, 결과, 달성", 
                 desc: "+ 행동으로 결과를 만들어내는 사람입니다. 일단 부딪혀 봅니다.\n+ 책임감이 강하고 현실적응력이 남달라 리더 기질을 발휘합니다.\n+ 하고 싶은 것을 해낼 에너지가 충만합니다.\n+ 방해 받는 것이 없는 상황에서 자신의 능력은 잘 발휘 해낼 수 있다는 점이 특징입니다.\n+ 주의 : 과로, 워커홀릭, 휴식이 필요함",
                 desc_detail: "+목적을 갖고 움직이는 힘과 열정으로 가득 차 있어 적극적으로 대응합니다." },
            3: { color: "ORANGE", keyword: "바람", title: "바람, 표현, 어린이, 악동, 감정, 만족", 
                 desc: "+ 목표를 달성하는 일이 곧 기쁨이자 즐거움이 됩니다.\n+ 인정받는 곳에서 능력을 100% 발휘합니다.\n+ 행동이 빠르고 일처리가 빠른 사람입니다.\n+ 기본적인 센스가 있고, 칭찬을 좋아합니다.\n+ 호기심 가득한 표정과 약간의 장난끼도 보입니다.\n+ 주의 : 예상치 못한 상황에서의 임기응변력은 조금 떨어집니다.",
                 desc_detail: "+외유내강으로 겉은 부드러우나 속은 단단합니다.\n+감정을 밖으로 표출하는 힘과 즐겁게 사는 것을 중요하게 여깁니다." },
            4: { color: "RED ORANGE", keyword: "과실나무", title: "과수(과일/과실), 개혁, 도전, 확대, 자유", 
                 desc: "+ 현실 안주란 없습니다. 더 나은 미래와 변화를 생각합니다.\n+ 에너지를 응축한 뒤 폭발해 내는 것이 특징입니다.\n+ 결과보다 목표 자체에 의의를 둡니다. 도전 자체가 살아있음을 느끼게 합니다.\n+ 야망가이며 칠전팔기로 될 때까지 해낼 수 있습니다.\n+ 주의 : 끈기부족, 생각으로 로딩(시간)이 걸릴 때도 있습니다.",
                 desc_detail: "+강한 에너지와 추진력을 가지며 목표를 향해 나아갑니다.\n+무언가를 새롭게 변화시키고자 하는 도전의식이 강합니다." },
            5: { color: "YELLOW", keyword: "하늘", title: "하늘, 선견력, 지식, 정보, 지성, 미래", 
                 desc: "+ 호기심이 왕성하며 배움에 대한 마음이 큽니다.\n+ 남들보다 앞서가는 선구자형이며 긍정적인 성향입니다.\n+ 변화, 소망, 연구에 있어 좋은 에너지가 있습니다.\n+ 행동보다 생각이 더 큰 편이지만, 행동범위는 넓습니다.\n+ 살아있음을 느낄 수 있는 생기 넘치는 환경이 좋습니다.\n+ 주의 : 세상 물정을 잘 모를 수 있음, 뜬구름, 아집주의",
                 desc_detail: "+자신의 생각과 감정을 솔직하게 표현하며 주변에 긍정적 영향을 줍니다.\n+앞을 내다보는 힘을 갖고 있으며 늘 밝고 명랑합니다." },
            6: { color: "YELLOW GREEN", keyword: "아기", title: "꽃, 관찰, 아기, 평화, 애정, 사랑", 
                 desc: "+ 사람 중심으로 사고하며 상냥하고 온화합니다.\n+ 주의 깊고 세심하게 관찰하는 힘을 갖고 있습니다.\n+ 안심할 수 있는 환경에서 능력이 발휘됩니다.\n+ 애정이 풍부하며, 애정을 확인받고 싶어합니다.\n+ 주의 : 편한 것만 찾는 것(행동력이 약함), 지나치게 돌려말하는 것, 애정결핍 주의",
                 desc_detail: "+다른 사람들을 수용하고 포용하는 큰 그릇을 가졌습니다.\n+매사에 주의깊고 유심히 보는 힘이 있으며 친절합니다." },
            7: { color: "GREEN", keyword: "숲", title: "안정력, 숲, 안식, 평화, 진정, 인내", 
                 desc: "+ 원리와 원칙에 기반하여 목표를 달성하고자 합니다.\n+ 사람 중심 성향으로 평화롭고 중립적입니다.\n+ 네트워크와 커뮤니티를 만드는 것을 좋아합니다.\n+ 스스로가 결정하는 것보다 다른 사람의 의견에 맞추는 것이 더 편안합니다.\n+ 주의 : 보수적인 성향, 불평불만, 변명, 피해의식",
                 desc_detail: "+순수하고 진실된 마음을 갖고 있으며 맡은 일에 최선을 다합니다.\n+상황을 차분하게 이끌며 평화를 사랑합니다." },
            8: { color: "TURQUOISE", keyword: "샘", title: "샘, 독립적, 자기, 심(心), 방어, 섬세", 
                 desc: "+ 자신에 대한 통찰이 깊고 자기 영역이 확고합니다.\n+ 무에서 유를 창조하는 기획성이 남다릅니다.\n+ 독립적, 독창적이며 혼자서 잘 하는 사람입니다.\n+ 공간적 시간적으로 자신 혼자만의 것이 필요합니다.\n+ 주의 : 임기응변력이 부족하며, 인간관계에 약합니다, 고지식한 면이 있을 수 있습니다.",
                 desc_detail: "+뛰어난 통찰력과 지적인 모습으로 상황을 빠르게 파악합니다.\n+자유분방하고 독립적인 사고를 하는 노력형 천재 타입입니다." },
            9: { color: "BLUE GREEN", keyword: "지구", title: "지구, 균형, 신념, 영역, 나의 평화", 
                 desc: "+ 균형을 추구하며 나의 평화가 우선입니다.\n+ 자신의 세계와 공간이 반드시 있어야 하는 사람입니다.\n+ 메타인지가 발달하여 자신에게 객관적입니다.\n+ 혼자서 할 수 있는 취미나 N잡가의 기질을 갖고 있습니다.\n+ 주의 : 꼰대주의, 잔소리, 타인을 지나치게 신경 안쓸 수 있습니다.",
                 desc_detail: "+세부 사항에 주의를 기울이며 정교하고 정확하게 접근합니다.\n+균형을 유지하는 힘으로 삶의 평화와 워라밸을 중시합니다." },
            10: { color: "BLUE", keyword: "달", title: "커뮤니케이션력, 달, 의사전달, 신뢰, 정직", 
                 desc: "+ 사람에 대한 유연성이 있고 책임감이 강합니다.\n+ 신뢰나 유대감을 소중히 여기며 전달 능력이 우수합니다.\n+ 거짓을 간파할 수 있으며 거짓말을 싫어합니다.\n+ 다른 사람과 마주할 때, 협력과 서포트에 능합니다.\n+ 주의 : 전체를 볼 수 있으나, 움직임은 소극적입니다.",
                 desc_detail: "+창의적이고 예술적인 성향과 감수성을 갖고 있습니다.\n+언어, 커뮤니케이션 능력이 탁월하며 성실한 사람입니다." },
            11: { color: "INDIGO", keyword: "바다", title: "이해력, 바다(해양), 진실, 심사사고, 내용", 
                 desc: "+ 깊은 사고를 하고 내면을 들여다보는 힘이 있습니다.\n+ 냉정하게 판단하고 처리하는 능력이 탁월합니다.\n+ 진실을 보는 눈과 통찰력이 좋습니다.\n+ 불굴의 정신력으로 재물을 축적해 낼 능력이 상당합니다. 기획, 분석, 감각 능력 좋음.\n+ 주의 : 자신에 대한 기준이 엄격합니다, 완벽주의",
                 desc_detail: "+문제를 해결하는 데 있어 논리적이고 체계적입니다.\n+전체를 파악하고 냉정하게 판단해 처리하는 능력을 갖췄습니다." },
            12: { color: "PURPLE", keyword: "우주", title: "우주, 직관, 감성, 촉, 감각적, 자유", 
                 desc: "+ 자신만의 이상이 있고 자유로움을 추구합니다.\n+ 직관이 발달하여 무의식적으로 결과를 만들어냅니다.\n+ 정신적인 것, 예술, 미적 감각이 탁월합니다.\n+ 세속적인 것에 연연하지 않고 꿈이나 가치를 쫓습니다.\n+ 주의 : 기분파, 변덕스러워 보임, 얇은 귀, 세상에 대한 불만",
                 desc_detail: "+일반적인 사고에 영향을 받지 않으며 직감적입니다.\n+변화와 안정감을 둘 다 추구하는 신비로운 매력이 있습니다." }
        };

        const attributeData = {
            "W-": { title: "조용한", desc: "+문제를 해결하는 데 있어서 논리적이고 체계적인 방법을 사용하는 타입입니다. \n+실수를 줄이고 더 나은 결과를 얻기위해서 깊은 생각을 해야합니다.\n+자신의 이야기를 밖으로 잘 꺼내지 않는 타입이라 거리감을 느낄 수 있습니다." },
            "W+": { title: "자유로운", desc: "+창의적이고 예술적인 성향과 감수성을 갖고 있습니다. \n+직관적인 판단력으로 자신만의 독특한 시각이 있습니다." },
            "T+": { title: "정직한", desc: "+행동으로 결과를 만들어냅니다. 열정이 가득하며 활력으로 위기를 극복합니다." },
            "T-": { title: "유순한", desc: "+외유내강으로 겉으로는 부드러워보이지만 속은 단단한 심지가 있습니다." },
            "F+": { title: "낙천적인", desc: "+강한 에너지와 추진력을 가지며, 목표를 향해 적극적으로 나아가는 성향이 있습니다." },
            "F-": { title: "섬세한", desc: "+자신의 생각과 감정을 솔직하게 표현하는 능력이 뛰어납니다. 섬세하며 정에 약한 타입입니다." },
            "E+": { title: "느긋한", desc: "+다른 사람들을 수용하고 포용하는 모습으로 큰 그릇을 가지고 있습니다." },
            "E-": { title: "서민적인", desc: "+순수하고 진실된 마음을 갖고 있습니다. 자신의 맡은 일에 있어 최선을 다합니다." },
            "M+": { title: "다부진", desc: "+뛰어난 통찰력과 지적인 모습으로 상황을 빠르게 파악할 수 있습니다." },
            "M-": { title: "아름다운", desc: "+세부 사항에 매우 주의를 기울이며, 정교하고 정확하게 접근하려고 합니다." }
        };

        const colorHexMap = {
            "MAGENTA": "#D1357A", "RED": "#E60012", "ORANGE": "#F39800", 
            "RED ORANGE": "#FF5F00", "YELLOW": "#FFD200", "YELLOW GREEN": "#9EBD25",
            "GREEN": "#009944", "TURQUOISE": "#00A0E9", "BLUE GREEN": "#0068B7",
            "BLUE": "#1D419B", "INDIGO": "#271E6E", "PURPLE": "#753B92"
        };

        const woonsungToColorNum = {
            "제왕": 1, "사": 2, "장생": 3, "목욕": 4, "관대": 5, "양": 6, 
            "묘": 7, "태": 8, "병": 9, "쇠": 10, "건록": 11, "절": 12
        };

        /* * ==========================================
         * 만세력 로직 (Saju Engine)
         * ==========================================
         */
        const Gan = ["갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"];
        const Ji = ["자", "축", "인", "묘", "진", "사", "오", "미", "신", "유", "술", "해"];
        const WoonsungOrder = ["장생", "목욕", "관대", "건록", "제왕", "쇠", "병", "사", "묘", "절", "태", "양"];
        
        // 장생 시작점 데이터
        const JangSaengStart = {
            "갑": { start: 11, dir: 1 }, "을": { start: 6, dir: -1 },
            "병": { start: 2, dir: 1 },  "정": { start: 9, dir: -1 },
            "무": { start: 2, dir: 1 },  "기": { start: 9, dir: -1 },
            "경": { start: 5, dir: 1 },  "신": { start: 0, dir: -1 },
            "임": { start: 8, dir: 1 },  "계": { start: 3, dir: -1 }
        };

        // 절기(Month Pillar) 약식 계산 (매월 4~8일 사이 교체)
        function getMonthJiIndex(month, day) {
            // 기준일 대략 6일로 설정 (API 없이 약식 구현)
            const cutOffDay = 6; 
            let m = month;
            if (day < cutOffDay) {
                m = m - 1;
                if (m === 0) m = 12;
            }
            // 2월(인) 시작 매핑
            const monthMap = { 2:2, 3:3, 4:4, 5:5, 6:6, 7:7, 8:8, 9:9, 10:10, 11:11, 12:0, 1:1 };
            return monthMap[m];
        }

        // 시지(Hour Pillar) 계산
        function getHourJiIndex(hour) {
            if (hour >= 23 || hour < 1) return 0; // 자
            if (hour < 3) return 1; if (hour < 5) return 2;
            if (hour < 7) return 3; if (hour < 9) return 4;
            if (hour < 11) return 5; if (hour < 13) return 6;
            if (hour < 15) return 7; if (hour < 17) return 8;
            if (hour < 19) return 9; if (hour < 21) return 10;
            return 11; // 해
        }

        function get12Woonsung(gan, jiIndex) {
            const info = JangSaengStart[gan];
            if (!info) return "절"; 
            let index;
            if (info.dir === 1) { // 순행
                index = (jiIndex - info.start + 12) % 12;
            } else { // 역행
                index = (info.start - jiIndex + 12) % 12;
            }
            return WoonsungOrder[index];
        }

        /* * ==========================================
         * 메인 기능 함수
         * ==========================================
         */

        // 1. 계산 및 화면 렌더링
        function calculateAndRender() {
            // 입력값 확인
            const name = document.getElementById('inpName').value;
            const dateStr = document.getElementById('inpDate').value;
            const timeStr = document.getElementById('inpTime').value;
            const attr = document.getElementById('inpAttr').value;

            if(!name || !dateStr) {
                alert("이름과 생년월일은 필수입니다.");
                return;
            }

            // --- 만세력 계산 수행 ---
            const dateObj = new Date(dateStr);
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();
            let hour = 12;
            if (timeStr) hour = parseInt(timeStr.split(':')[0]);

            // 일주 계산
            const baseDate = new Date(1900, 0, 1); // 갑술일
            const targetDate = new Date(year, month - 1, day);
            const diffTime = targetDate.getTime() - baseDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            let dayGanIdx = (diffDays) % 10; 
            if (dayGanIdx < 0) dayGanIdx += 10;
            const myGan = Gan[dayGanIdx]; 

            let dayJiIdx = (diffDays + 10) % 12; 
            if (dayJiIdx < 0) dayJiIdx += 12;
            
            // 월주, 년주, 시지 계산
            const monthJiIdx = getMonthJiIndex(month, day);
            
            let sajuYear = year;
            if (month === 1 || (month === 2 && day < 4)) sajuYear--;
            let yearJiIdx = (sajuYear - 1984) % 12;
            if (yearJiIdx < 0) yearJiIdx += 12;

            const hourJiIdx = getHourJiIndex(hour);

            // 12운성 도출
            const w1 = get12Woonsung(myGan, dayJiIdx);    // 일지 (선천)
            const w2 = get12Woonsung(myGan, monthJiIdx);  // 월지 (후천)
            const w3 = get12Woonsung(myGan, yearJiIdx);   // 년지 (목표)
            const w4 = get12Woonsung(myGan, hourJiIdx);   // 시지 (노하우)

            // 숫자 매핑 및 입력창 업데이트
            const n1 = woonsungToColorNum[w1];
            const n2 = woonsungToColorNum[w2];
            const n3 = woonsungToColorNum[w3];
            const n4 = woonsungToColorNum[w4];

            document.getElementById('resNum1').value = n1;
            document.getElementById('resNum2').value = n2;
            document.getElementById('resNum3').value = n3;
            document.getElementById('resNum4').value = n4;

            // --- 결과지 렌더링 ---
            
            // 헤더 정보
            document.getElementById('outName').innerText = `${name} ${year}.${month}.${day}`;
            const today = new Date();
            document.getElementById('outDate').innerText = `${today.getFullYear()}-${(today.getMonth()+1).toString().padStart(2,'0')}-${today.getDate()}`;

            // 속성 정보
            document.getElementById('outAttrCode').innerText = attr;
            if(attributeData[attr]) {
                document.getElementById('outAttrDesc').innerText = attributeData[attr].desc;
            }

            // 각 섹션 채우기 헬퍼
            const fillSection = (num, idx) => {
                const data = humanColorData[num];
                if(!data) return;

                // 요약 그리드
                document.getElementById(`sum${idx}_val`).innerText = data.keyword; // ex: 숲
                // 여기서 요약 설명은 desc_detail 사용
                document.getElementById(`sum${idx}_desc`).innerText = data.desc_detail; 

                // 메인 섹션
                const colorEl = document.getElementById(`main${idx}_color`);
                colorEl.innerText = data.color;
                colorEl.style.color = colorHexMap[data.color] || '#333';
                
                document.getElementById(`main${idx}_key`).innerText = data.title;
                document.getElementById(`main${idx}_text`).innerText = data.desc;
            };

            // 수동으로 숫자를 바꿨을 수도 있으니 입력창 값 다시 읽기
            fillSection(document.getElementById('resNum1').value, 1);
            fillSection(document.getElementById('resNum2').value, 2);
            fillSection(document.getElementById('resNum3').value, 3);
            fillSection(document.getElementById('resNum4').value, 4);

            alert("결과지 생성 완료! 아래 내용을 확인하세요.");
        }

        // 2. PDF 다운로드
        function downloadPDF() {
            const element = document.getElementById('reportArea');
            const name = document.getElementById('inpName').value || "결과";

            // 옵션 설정
            const opt = {
                margin:       0,
                filename:     `${name}_휴먼컬러_결과지.pdf`,
                image:        { type: 'jpeg', quality: 1 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // 다운로드 실행
            html2pdf().from(element).set(opt).save();
        }
    </script>
</body>
</html>
